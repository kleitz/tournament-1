/*!
 * Titon Toolkit v0.2.0
 * Copyright 2010-2013, The Titon Project - http://titon.io
 * BSD-2 - https://github.com/titon/Toolkit/blob/master/license.md
 * Components: base, tabs
 * Dependencies: Core, More/Class.Binds, More/Element.Measure, More/Elements.From, More/Hash, More/Locale
 */
!function(a){"use strict";a.Titon={version:"0.2.0",options:{prefix:"",activeClass:"is-active",disabledClass:"is-disabled",openClass:"is-open",draggableClass:"is-draggable",draggingClass:"is-dragging",loadingClass:"is-loading",failedClass:"has-failed"},setup:function(a){Titon.options=Object.merge(Titon.options,a)},parseOptions:function(a,b){var c={};return"object"===typeOf(a)?Object.merge(c,a):a&&(c[b]=a),c}},Locale.define("en-US","Titon",{loading:"Loading...",error:"An error has occurred!"}),Element.implement({show:function(b){return b===!0?this.setStyle("display",""):"fade"===b||this.hasClass("fade")?(this.show(!0).setStyle("opacity",0),a.setTimeout(function(){this.setStyle("opacity",1)}.bind(this),10)):"slide"===b||this.hasClass("slide")?this.setStyle("height",this.measure(function(){return this.setStyle("height","auto").getHeight()})):this.setStyle("display",""),this},hide:function(a){if(a===!0)this.setStyle("display","none");else if("fade"===a||this.hasClass("fade")){var b=function(){this.hide(!0).removeEvent("transitionend",b)};this.addEvent("transitionend",b).setStyle("opacity",0)}else"slide"===a||this.hasClass("slide")?this.setStyle("height",0):this.setStyle("display","none");return this},isVisible:function(){var a="none"!==this.getStyle("display");return this.hasClass("fade")?a&&this.getStyle("opacity")>0:this.hasClass("slide")?a&&this.getStyle("height").toInt()>0:a}}),Element.Properties.html.set=function(a){var b=typeOf(a);return"element"===b?(this.innerHTML="",this.appendChild(a),this):("string"===b&&"#"===a.substr(0,1)?a=document.getElement(a).get("html"):"array"===b&&(a=a.join("")),this.innerHTML=a,this)},String.implement({remove:function(a){return"array"!==typeOf(a)&&(a=a.toString().split("")),this.replace(new RegExp("["+a.join("|")+"]+","ig"),"")}}),Array.implement({chunk:function(a){var b=this;return[].concat.apply([],b.map(function(c,d){return d%a?[]:[b.slice(d,d+a)]}))}});var b=function(){var a=document.documentElement.style,b={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",MSTransitionEnd:"msTransitionEnd"};for(var c in b)if(b.hasOwnProperty(c)&&"null"!==typeOf(a[c]))return b[c];return null}();Element.NativeEvents[b]=2}(window);
!function(){"use strict";Titon.Component=new Class({Implements:[Events,Options],Binds:["_show","_hide","_position"],cache:{},element:null,elements:[],node:null,query:null,options:{className:"",context:null,fade:!1,mode:"click",errorMessage:null,loadingMessage:null,multiElement:!1,template:"",templateFrom:"",parseTemplate:!0,onInit:null,onHide:null,onShow:null},initialize:function(a,b){if(this.setOptions(b||{}),b=this.options,"element"===typeOf(a)?(this.element=a,this.query=this.element.get("id"),b.parseTemplate=!1):"elements"===typeOf(a)?(this.elements=a,this.query=this.elements.get("class"),b.multiElement=!0):this.query=a,b.multiElement&&(b.parseTemplate=!1),b.parseTemplate&&!this.element){var c;c="element"===typeOf(b.templateFrom)?b.templateFrom:$(b.templateFrom.remove("#")),!c&&b.template&&(c=this.parseTemplate(b.template),c&&c.hide(!0).inject(document.body)),c&&(this.element=c)}b.className&&(this.element?this.element.addClass(b.className):this.elements&&this.elements.addClass(b.className))},className:function(){return new Hash(window.Titon).keyOf(this.$constructor)},disable:function(){return this._toggleEvents(!1)},enable:function(){return this._toggleEvents(!0)},getValue:function(a,b){return b?"function"===typeOf(b)?b(a,this):a.get(b):null},hide:function(a){this.isVisible()&&(this.element.hide(),"function"===typeOf(a)&&a(),this.fireEvent("hide"))},isVisible:function(){return this.element&&this.element.isVisible()},parseTemplate:function(a){if(!a)return null;if("element"===typeOf(a))return a;var b=Elements.from(a);if(b[0])return b=b[0],Titon.options.prefix&&b.set("class",Titon.options.prefix+b.get("class")),b;throw new Error(this.className()+" template failed to parse")},requestData:function(a){this.cache[a]||new Request({url:a,method:"get",evalScripts:!0,onSuccess:function(b){this.cache[a]=b,this.options.showLoading&&this.element.removeClass(Titon.options.loadingClass),this._position(b)}.bind(this),onRequest:function(){this.cache[a]=!0,this.options.showLoading&&(this.element.addClass(Titon.options.loadingClass),this._position(this._loadingTemplate()))}.bind(this),onFailure:function(){delete this.cache[a],this.element.removeClass(Titon.options.loadingClass).addClass(Titon.options.failedClass),this._position(this._errorTemplate())}.bind(this)}).get()},reset:function(a){return this.element&&a&&(this.element.dispose(),this.element=null),this.cache={},this.node=null,this},show:function(a){this.node=a,this.element.show(),this.fireEvent("show")},toElement:function(){return this.element},_errorTemplate:function(){return new Element("div."+this.className().toLowerCase()+"-error",{text:this.options.errorMessage||Locale.get("Titon.error")})}.protect(),_hide:function(a){"domevent"===typeOf(a)&&a.stop(),this.hide()},_loadingTemplate:function(){return new Element("div."+this.className().toLowerCase()+"-loading",{text:this.options.loadingMessage||Locale.get("Titon.loading")})}.protect(),_position:function(a){this.element.set("html",a)},_show:function(a,b){"domevent"===typeOf(a)&&a.stop(),this.isVisible()&&("click"===this.options.mode&&this.hide(),b===this.node)||this.show(b)},_toggleEvents:function(a){if(!this.query)return this;var b=this.options,c=("click"===this.options.mode?"click":"mouseenter")+":relay("+this.query+")",d=$(b.context||document.body);return a?d.addEvent(c,this._show):d.removeEvent(c,this._show),this}.protect()})}();
!function(){"use strict";Titon.Tabs=new Class({Extends:Titon.Component,sections:[],tabs:[],previousIndex:0,currentIndex:0,options:{ajax:!0,collapsible:!1,defaultIndex:0,persistState:!1,preventDefault:!0,cookie:null,cookieDuration:30,tabsElement:"nav a",sectionsElement:"section"},initialize:function(a,b){if(b=b||{},b.cookie=(b.cookie||a).camelCase(),b.templateFrom=a,b.template=!1,this.parent(a,b),this.element){this.tabs=this.element.getElements(this.options.tabsElement),this.tabs.each(function(a,b){a.set("data-tabs-index",b).removeClass(Titon.options.activeClass)}),this.sections=this.element.getElements(this.options.sectionsElement),this.sections.hide(!0),this.options.fade&&this.sections.addClass("fade"),this.disable().enable(),this.fireEvent("init");var c=Number.from(Cookie.read("titon.tabs."+this.options.cookie)||this.options.defaultIndex);this.jump(c)}},hide:function(){this.sections.hide(!0),this.fireEvent("hide",this.node)},jump:function(a){this.tabs[a]&&this.show(this.tabs[a])},show:function(a){var b=Titon.options.activeClass,c=Titon.options.loadingClass,d=Titon.options.failedClass,e=a.get("data-tabs-index"),f=this.sections[e],g=a.get("href");this.options.ajax&&g&&!g.contains("#")&&!this.cache[g]&&new Request({url:g,method:"get",evalScripts:!0,onSuccess:function(a){this.cache[g]=!0,f.set("html",a).removeClass(c)}.bind(this),onRequest:function(){f.set("html",this._loadingTemplate()).addClass(c)}.bind(this),onFailure:function(){f.set("html",this._errorTemplate()).removeClass(c).addClass(d)}.bind(this)}).get(),this.tabs.removeClass(b),e===this.currentIndex&&this.options.collapsible?f.isVisible()?f.hide():(a.addClass(b),f.show()):(this.hide(),a.addClass(b),f.show()),this.options.persistState&&Cookie.write("titon.tabs."+this.options.cookie,e,{duration:this.options.cookieDuration}),this.previousIndex=this.currentIndex,this.currentIndex=e,this.fireEvent("show",a),this.node=a},_show:function(a){this.options.preventDefault&&a.preventDefault(),this.show(a.target)},_toggleEvents:function(a){if(!this.query)return this;var b="click"===this.options.mode?"click":"mouseover";return a?this.tabs.addEvent(b,this._show):this.tabs.removeEvent(b,this._show),"mouseover"===b&&this.options.preventDefault&&this.tabs.addEvent("click",function(a){a.preventDefault()}),this}.protect()}),Titon.Tabs.instances={},Titon.Tabs.factory=function(a,b){if(Titon.Tabs.instances[a])return Titon.Tabs.instances[a];var c=new Titon.Tabs(a,b);return Titon.Tabs.instances[a]=c,c}}();